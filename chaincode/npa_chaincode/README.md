# Структура NPA Chaincode

## Описание структуры проекта

Проект организован в модульную структуру для улучшения читаемости, поддерживаемости и тестируемости кода.

```
chaincode/
└── npa_chaincode/
    ├── __init__.py      # Инициализация пакета и экспорт основных классов
    ├── chaincode.py     # Основная бизнес-логика chaincode
    ├── state.py         # Управление состоянием в ledger
    └── utils.py         # Вспомогательные функции и утилиты
```

## Назначение файлов

### `chaincode.py` - Основной модуль

**Назначение:**
- Содержит основную бизнес-логику chaincode
- Определяет класс `NPAChaincode` с методами для работы с задачами и документами
- Реализует функции:
  - `createTask` - создание новой задачи
  - `updateTaskStatus` - обновление статуса задачи
  - `addDocumentVersion` - добавление версии документа
  - `getDocumentVersions` - получение всех версий документа
  - `getTask` - получение задачи по ID
- Обрабатывает вызовы chaincode и маршрутизирует к соответствующим методам
- Использует `StateManager` для работы с ledger
- Использует утилиты из `utils` для валидации и форматирования

**Основные компоненты:**
- Класс `NPAChaincode` - главный класс chaincode
- Функция `invoke_chaincode()` - точка входа для вызовов chaincode

### `state.py` - Управление состоянием

**Назначение:**
- Инкапсулирует всю логику работы с состоянием в Hyperledger Fabric ledger
- Предоставляет высокоуровневый интерфейс для чтения и записи данных
- Обрабатывает ошибки при работе с ledger
- Поддерживает различные операции:
  - Получение данных по ключу
  - Сохранение данных
  - Удаление данных
  - Получение диапазона данных
  - Работа с составными ключами
  - Получение истории изменений

**Основные компоненты:**
- Класс `StateManager` - менеджер состояния
- Методы для работы с ключами и значениями
- Обработка JSON сериализации/десериализации

**Преимущества:**
- Централизованная обработка ошибок
- Единый интерфейс для работы с ledger
- Легкое тестирование (можно мокировать StateManager)
- Переиспользование кода

### `utils.py` - Вспомогательные функции

**Назначение:**
- Содержит вспомогательные функции для chaincode
- Валидация данных (статусы, задачи, версии документов)
- Форматирование ответов
- Константы и настройки
- Утилиты для работы со строками и данными

**Основные компоненты:**
- Константы статусов задач
- Функции валидации: `validate_status()`, `validate_task_data()`, `validate_document_version_data()`
- Функции форматирования: `format_response()`
- Утилиты: `create_task_key()`, `sanitize_string()`, `get_current_timestamp()`, `parse_metadata()`

**Преимущества:**
- Переиспользование кода валидации
- Единообразное форматирование ответов
- Централизованные константы
- Легкое добавление новых утилит

## Преимущества модульной структуры

1. **Разделение ответственности**: Каждый модуль отвечает за свою область
2. **Читаемость**: Код легче понимать и навигировать
3. **Тестируемость**: Каждый модуль можно тестировать независимо
4. **Поддерживаемость**: Изменения в одном модуле не влияют на другие
5. **Переиспользование**: Утилиты и StateManager можно использовать в других проектах
6. **Масштабируемость**: Легко добавлять новые функции и модули

## Использование

```python
from npa_chaincode import NPAChaincode, StateManager
from npa_chaincode.utils import validate_status, format_response

# Инициализация chaincode
chaincode = NPAChaincode(stub)

# Использование методов
result = chaincode.create_task(
    task_id="TASK001",
    title="Новая задача",
    description="Описание",
    assignee="user1",
    creator="admin"
)
```

## Расширение структуры

При необходимости можно добавить дополнительные модули:

- `models.py` - Модели данных
- `validators.py` - Расширенная валидация
- `exceptions.py` - Кастомные исключения
- `constants.py` - Константы и настройки
- `tests/` - Тесты для каждого модуля

